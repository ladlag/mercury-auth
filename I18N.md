# 国际化 (i18n) 支持

## 概述

本系统支持中文和英文的参数验证错误消息。默认情况下，系统会返回中文错误消息，但可以通过HTTP请求头切换为英文。

## 功能特性

- **默认语言**: 中文 (zh-CN)
- **支持语言**: 中文、英文
- **自动检测**: 根据 `Accept-Language` HTTP 头自动选择语言
- **验证消息**: 所有参数验证错误消息都已国际化

## 使用方法

### 默认行为 (中文)

不设置 `Accept-Language` 头时，默认返回中文错误消息：

```bash
curl -X POST http://localhost:10000/auth/api/auth/password/register \
  -H "Content-Type: application/json" \
  -d '{
    "tenantId": "",
    "username": "",
    "password": ""
  }'
```

返回:
```json
{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed",
  "errors": [
    {"field": "tenantId", "message": "租户ID必填"},
    {"field": "username", "message": "用户名必填"},
    {"field": "password", "message": "密码必填"}
  ]
}
```

### 英文错误消息

设置 `Accept-Language: en` 头时，返回英文错误消息：

```bash
curl -X POST http://localhost:10000/auth/api/auth/password/register \
  -H "Content-Type: application/json" \
  -H "Accept-Language: en" \
  -d '{
    "tenantId": "",
    "username": "",
    "password": ""
  }'
```

返回:
```json
{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed",
  "errors": [
    {"field": "tenantId", "message": "Tenant ID is required"},
    {"field": "username", "message": "Username is required"},
    {"field": "password", "message": "Password is required"}
  ]
}
```

### 中文错误消息

设置 `Accept-Language: zh-CN` 头时，显式返回中文错误消息：

```bash
curl -X POST http://localhost:10000/auth/api/auth/password/register \
  -H "Content-Type: application/json" \
  -H "Accept-Language: zh-CN" \
  -d '{
    "tenantId": "",
    "username": "",
    "password": ""
  }'
```

## 技术实现

### 配置类

`LocaleConfig.java` 配置了以下内容：

1. **LocaleResolver**: 使用 `AcceptHeaderLocaleResolver` 根据请求头自动选择语言
2. **MessageSource**: 配置资源文件加载器
3. **Validator**: 集成验证器与消息源

### 资源文件

- `ValidationMessages.properties` - 英文消息 (默认)
- `ValidationMessages_zh_CN.properties` - 中文消息

### 验证注解

所有DTO类中的验证注解都使用消息键而不是硬编码消息：

```java
@NotBlank(message = "{validation.username.required}")
private String username;
```

## 添加新的验证消息

1. 在 `ValidationMessages.properties` 中添加英文消息
2. 在 `ValidationMessages_zh_CN.properties` 中添加对应的中文消息
3. 在DTO类的验证注解中使用消息键: `{validation.key.name}`

示例:
```properties
# ValidationMessages.properties
validation.newfield.required=New field is required

# ValidationMessages_zh_CN.properties  
validation.newfield.required=新字段必填
```

```java
@NotBlank(message = "{validation.newfield.required}")
private String newField;
```

## 测试

运行验证消息测试：

```bash
mvn test -Dtest=ValidationMessagesTest
```

运行集成测试：

```bash
mvn test -Dtest=ChineseValidationIntegrationTest
```

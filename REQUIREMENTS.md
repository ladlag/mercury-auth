# Spring Boot JWT 用户认证与授权服务需求

## 1. 概要
- 基于 Spring Boot 2.7.x（JDK 8）+ Spring Security + JWT 的 REST 服务。
- 面向多租户，提供注册/登录、Token 签发与验证、黑名单注销、日志与健康检查。

## 2. 核心场景
### 2.1 多租户
- 租户管理：创建、查询、启用/禁用；分配唯一 Tenant ID。
- 数据隔离：所有用户/验证码/日志等均带 Tenant ID 字段，避免串租户。
- 租户级配置：Token 过期时长、密码复杂度、验证码有效期/长度、支持的登录方式等可配置。

### 2.2 用户名密码注册/登录
- 注册：租户ID、用户名、密码、确认密码、邮箱/手机号（可选）。校验租户启用、用户名唯一、密码复杂度，BCrypt 加密存储。
- 登录：租户ID、用户名、密码；校验租户状态、用户存在与密码匹配，签发 JWT（含租户ID、用户ID、用户名、过期时间）。

### 2.3 邮箱验证码注册/登录
- 发送验证码：租户ID+邮箱，校验格式与唯一性/存在性，发送 6 位验证码；有效期默认 10 分钟（可按租户配置），存 Redis。
- 注册：携带租户ID、邮箱、验证码、用户名、密码/确认密码；校验验证码有效后创建用户并返回成功。
- 登录：租户ID+邮箱，发送验证码；验证通过后生成 JWT。

### 2.4 手机验证码注册/登录（预留）
- 发送 6 位短信验证码（租户可配置有效期），存 Redis；对接可替换的短信服务接口。
- 基于租户ID+手机号+验证码完成注册/登录并签发 JWT。

### 2.5 微信扫码注册/登录（预留）
- 对接微信开放平台（OAuth2），扫码后确认身份，完成注册或登录。
- 注册需关联租户ID并补充必要用户信息，成功后签发 JWT。

### 2.6 Token 验证与黑名单
- 提供 Token 校验接口：校验格式、签名、过期、租户匹配、用户状态。
- 黑名单支持注销/登出：将 Token 置入黑名单（Redis），过期时间与 Token 同步。
- 校验成功返回租户ID、用户ID、用户名；失败返回明确原因。

### 2.7 其他
- 用户管理：查询、修改密码（旧密码或验证码校验）、启用/禁用（管理员）。
- 认证日志：记录租户ID、用户ID、操作类型/时间、结果、IP，支持查询。
- API 文档：Swagger（Springfox）自动生成。
- 健康检查：服务、数据库、Redis 状态。

## 3. 技术栈与约束
- Spring Boot 2.7.x，JDK 8；MySQL 5.7+；Redis 6.0+；MyBatis-Plus；JJWT；Springfox Swagger；BCrypt；HikariCP。
- 全部组件需开源可商用；RESTful JSON；支持 CORS。

## 4. 安全与性能
- 密码加密存储，HTTPS 传输；Token 密钥可轮换、可配置过期（默认 ≤2h）。
- Token 携带必要声明，敏感信息加密；接口参数校验防注入/XSS；登录/验证码发送限流（如单 IP 每分钟≤10次）。
- 性能：普通查询/校验 ≤100ms，Token 生成/验证码发送 ≤500ms；单机并发用户数≥500，Token 校验 QPS≥1000；Redis 命中率≥90%。
- 可靠性：可用性≥99.9%；验证码发送失败重试≤3次，间隔1s；数据库/Redis 异常需友好错误处理与事务保证。

## 5. 配置与可扩展
- 可配置：Token 过期、密码复杂度、验证码长度/有效期、登录方式开关、限流规则、密钥/密钥对、CORS。
- 架构分层（Controller/Service/DAO），便于扩展新的登录方式。
- 支持单机与集群部署，集群需保证 Token 校验与缓存一致性。

## 6. 部署
- 提供基于 docker-compose 的部署说明：包含应用服务、MySQL、Redis；暴露必要端口与环境变量（如 JWT 密钥、DB/Redis 连接、租户默认配置等）。

spring:
  datasource:
    url: ${DB_URL:jdbc:mysql://localhost:3306/mercury_auth_new?useSSL=false&serverTimezone=UTC}
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:root}
    driver-class-name: com.mysql.cj.jdbc.Driver
  redis:
    # Standalone mode configuration
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    database: ${REDIS_DATABASE:0}
    password: ${REDIS_PASSWORD:#{null}}  # Password for Redis master/slaves
    
    # Sentinel mode configuration (automatically enabled when REDIS_SENTINEL_MASTER is set)
    # When sentinel configuration is provided, standalone mode is ignored
    sentinel:
      master: ${REDIS_SENTINEL_MASTER:#{null}}  # Sentinel master name
      nodes: ${REDIS_SENTINEL_NODES:#{null}}  # Format: host1:port1,host2:port2,host3:port3
      password: ${REDIS_SENTINEL_PASSWORD:#{null}}  # Password for Sentinel nodes (if authentication enabled)
  mail:
    from: "no-reply@example.com"
    host: smtp.example.com
    port: 25
    username: user
    password: pass
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: false

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true

security:
  jwt:
    secret: ${JWT_SECRET}
    ttl-seconds: 7200
  code:
    ttl-minutes: 10
    phone-ttl-minutes: 5
    # OTP protection settings
    cooldown-seconds: ${CODE_COOLDOWN_SECONDS:60}  # Minimum time between code requests
    max-daily-requests: ${CODE_MAX_DAILY_REQUESTS:20}  # Maximum code requests per day per identifier
    max-verify-attempts: ${CODE_MAX_VERIFY_ATTEMPTS:5}  # Maximum verification attempts before lockout
  rate-limit:
    # Rate limiting configuration for various auth operations
    # Default settings (backward compatibility)
    max-attempts: ${RATE_LIMIT_MAX_ATTEMPTS:10}
    window-minutes: ${RATE_LIMIT_WINDOW_MINUTES:1}
    
    # IP-based rate limiting for additional protection against distributed attacks
    ip:
      max-attempts: ${RATE_LIMIT_IP_MAX_ATTEMPTS:50}  # Higher limit for IP-based rate limiting
      window-minutes: ${RATE_LIMIT_IP_WINDOW_MINUTES:1}
    
    # Verification code sending - more restrictive to prevent abuse
    # Applies to: RATE_LIMIT_SEND_EMAIL_CODE, RATE_LIMIT_SEND_PHONE_CODE
    send-code:
      max-attempts: ${RATE_LIMIT_SEND_CODE_MAX_ATTEMPTS:5}   # More restrictive: 5 code requests per minute
      window-minutes: ${RATE_LIMIT_SEND_CODE_WINDOW_MINUTES:1}
    
    # Login operations - balanced limits
    # Applies to: RATE_LIMIT_LOGIN_PASSWORD, RATE_LIMIT_LOGIN_EMAIL, RATE_LIMIT_LOGIN_PHONE
    login:
      max-attempts: ${RATE_LIMIT_LOGIN_MAX_ATTEMPTS:10}  # Standard login attempts
      window-minutes: ${RATE_LIMIT_LOGIN_WINDOW_MINUTES:1}
    
    # Captcha generation - more permissive since users need multiple captchas
    # Applies to: CAPTCHA_LOGIN_PASSWORD, CAPTCHA_LOGIN_EMAIL, CAPTCHA_LOGIN_PHONE
    captcha:
      max-attempts: ${RATE_LIMIT_CAPTCHA_MAX_ATTEMPTS:20}  # Higher limit: users may need multiple captcha images
      window-minutes: ${RATE_LIMIT_CAPTCHA_WINDOW_MINUTES:1}
    
    # Token refresh operations
    # Applies to: RATE_LIMIT_REFRESH_TOKEN
    refresh-token:
      max-attempts: ${RATE_LIMIT_REFRESH_TOKEN_MAX_ATTEMPTS:10}
      window-minutes: ${RATE_LIMIT_REFRESH_TOKEN_WINDOW_MINUTES:1}
  captcha:
    threshold: 3
    ttl-minutes: 5

# Swagger/OpenAPI configuration - DISABLED in production for security
springdoc:
  api-docs:
    enabled: false
  swagger-ui:
    enabled: false

logging:
  level:
    com.mercury.auth: INFO
    org.springframework: WARN
    org.springframework.security: WARN

# SECURITY NOTE: Never commit secrets to version control
# Set JWT_SECRET, DB_PASSWORD, MAIL_PASSWORD, etc. via environment variables
# For production deployment, use secrets management (e.g., Kubernetes Secrets, AWS Secrets Manager)


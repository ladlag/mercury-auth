spring:
  application:
    name: mercury-auth
  datasource:
    url: jdbc:mysql://localhost:3306/mercury_auth_new?useSSL=false&serverTimezone=UTC
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
  redis:
    # Standalone mode configuration
    host: localhost
    port: 6379
    database: 0
    # password: your-redis-password  # Password for Redis master/slaves (uncomment if required)
    
    # Sentinel mode configuration (uncomment to enable)
    # When sentinel configuration is provided, standalone mode is ignored
    # sentinel:
    #   master: mymaster  # The master name configured in sentinel
    #   nodes: sentinel1:26379,sentinel2:26379,sentinel3:26379  # Comma-separated list of sentinel nodes
    #   password: your-sentinel-password  # Password for Sentinel nodes (uncomment if authentication enabled)
  mail:
    from: "no-reply@example.com"
    host: smtp.example.com
    port: 25
    username: user
    password: pass
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: false

# SMS Configuration (optional)
# Configure either Aliyun or Tencent Cloud SMS provider
# Only one provider needs to be configured

# Alibaba Cloud (Aliyun) SMS Configuration
sms:
  aliyun:
    enabled: false  # Set to true to enable Aliyun SMS
    access-key-id: your-aliyun-access-key-id
    access-key-secret: your-aliyun-access-key-secret
    sign-name: your-sign-name  # SMS signature
    template-code: SMS_123456789  # SMS template code
    region-id: cn-hangzhou  # Region ID (default: cn-hangzhou)
  
  # Tencent Cloud SMS Configuration
  tencent:
    enabled: false  # Set to true to enable Tencent SMS
    secret-id: your-tencent-secret-id
    secret-key: your-tencent-secret-key
    sdk-app-id: your-sdk-app-id  # SMS SDK App ID
    sign-name: your-sign-name  # SMS signature
    template-id: "123456"  # SMS template ID
    region: ap-guangzhou  # Region (default: ap-guangzhou)

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true

security:
  jwt:
    # Development secret - replace with strong secret in production
    # Use JWT_SECRET environment variable to override
    secret: ${JWT_SECRET:dev-secret-change-in-production-f136803ab9c241079ba0cc1b5d02ee77}
    ttl-seconds: 7200
  token-cache:
    # Token cache configuration for performance optimization
    max-size: 10000  # Maximum number of tokens to cache
    expire-after-write-seconds: 300  # Cache expiry time (5 minutes)
  code:
    ttl-minutes: 10
    phone-ttl-minutes: 5
    # OTP protection settings
    cooldown-seconds: 60  # Minimum time between code requests
    max-daily-requests: 20  # Maximum code requests per day per identifier
    max-verify-attempts: 5  # Maximum verification attempts before lockout
  rate-limit:
    # Rate limiting configuration for various auth operations
    # Default settings (backward compatibility)
    max-attempts: 10
    window-minutes: 1
    
    # IP-based rate limiting for additional protection
    ip:
      max-attempts: 50  # Higher limit for IP-based rate limiting
      window-minutes: 1
    
    # Verification code sending - more restrictive to prevent abuse
    # Applies to: RATE_LIMIT_SEND_EMAIL_CODE, RATE_LIMIT_SEND_PHONE_CODE
    send-code:
      max-attempts: 5   # More restrictive: 5 code requests per minute
      window-minutes: 1
    
    # Login operations - balanced limits
    # Applies to: RATE_LIMIT_LOGIN_PASSWORD, RATE_LIMIT_LOGIN_EMAIL, RATE_LIMIT_LOGIN_PHONE
    login:
      max-attempts: 10  # Standard login attempts
      window-minutes: 1
    
    # Captcha generation - more permissive since users need multiple captchas
    # Applies to: CAPTCHA_LOGIN_PASSWORD, CAPTCHA_LOGIN_EMAIL, CAPTCHA_LOGIN_PHONE
    captcha:
      max-attempts: 20  # Higher limit: users may need multiple captcha images
      window-minutes: 1
    
    # Token refresh operations
    # Applies to: RATE_LIMIT_REFRESH_TOKEN
    refresh-token:
      max-attempts: 10
      window-minutes: 1
  captcha:
    threshold: 3
    ttl-minutes: 5

# Swagger/OpenAPI configuration
springdoc:
  api-docs:
    enabled: true  # Enable in dev for testing
  swagger-ui:
    enabled: true  # Enable in dev for testing

logging:
  level:
    com.mercury.auth: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG

# NOTE: This is development configuration
# For production, use environment variables and secrets management

